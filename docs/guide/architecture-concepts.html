<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Architecture Concepts | Goyave</title>
    <meta name="description" content="An Elegant Golang Web Framework">
    <link rel="icon" type="image/png" sizes="16x16" href="/goyave/goyave_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/goyave/goyave_32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="/goyave/goyave_64.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/goyave/goyave_128.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/goyave/goyave_256.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/goyave/goyave_512.png">
    
    <link rel="preload" href="/goyave/assets/css/0.styles.3299ef2d.css" as="style"><link rel="preload" href="/goyave/assets/js/app.9469ee64.js" as="script"><link rel="preload" href="/goyave/assets/js/2.f9d2a18e.js" as="script"><link rel="preload" href="/goyave/assets/js/14.aee9063a.js" as="script"><link rel="prefetch" href="/goyave/assets/js/10.7e68f333.js"><link rel="prefetch" href="/goyave/assets/js/11.e70c4230.js"><link rel="prefetch" href="/goyave/assets/js/12.9701ad06.js"><link rel="prefetch" href="/goyave/assets/js/13.ec39cc61.js"><link rel="prefetch" href="/goyave/assets/js/15.4426d673.js"><link rel="prefetch" href="/goyave/assets/js/16.1928102c.js"><link rel="prefetch" href="/goyave/assets/js/17.cf145c44.js"><link rel="prefetch" href="/goyave/assets/js/18.df4a0600.js"><link rel="prefetch" href="/goyave/assets/js/19.ea3ed8c2.js"><link rel="prefetch" href="/goyave/assets/js/20.1a356f15.js"><link rel="prefetch" href="/goyave/assets/js/21.43491254.js"><link rel="prefetch" href="/goyave/assets/js/22.716c8988.js"><link rel="prefetch" href="/goyave/assets/js/23.1288d7e1.js"><link rel="prefetch" href="/goyave/assets/js/24.b60032a5.js"><link rel="prefetch" href="/goyave/assets/js/25.950d249c.js"><link rel="prefetch" href="/goyave/assets/js/26.b9fdc11e.js"><link rel="prefetch" href="/goyave/assets/js/27.71fbd69a.js"><link rel="prefetch" href="/goyave/assets/js/3.f67f2808.js"><link rel="prefetch" href="/goyave/assets/js/4.c70817cb.js"><link rel="prefetch" href="/goyave/assets/js/5.c4f79426.js"><link rel="prefetch" href="/goyave/assets/js/6.69c6329d.js"><link rel="prefetch" href="/goyave/assets/js/7.22671044.js"><link rel="prefetch" href="/goyave/assets/js/8.7cf85661.js"><link rel="prefetch" href="/goyave/assets/js/9.1fd8521e.js">
    <link rel="stylesheet" href="/goyave/assets/css/0.styles.3299ef2d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/goyave/" class="home-link router-link-active"><img src="/goyave/goyave_64.png" alt="Goyave" class="logo"> <span class="site-name can-hide">Goyave</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/goyave/guide/" class="nav-link router-link-active">Guide</a></div> <a href="https://github.com/System-Glitch/goyave" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/goyave/guide/" class="nav-link router-link-active">Guide</a></div> <a href="https://github.com/System-Glitch/goyave" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/goyave/guide/" class="sidebar-link">Introduction</a></li><li><a href="/goyave/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/goyave/guide/upgrade-guide.html" class="sidebar-link">Upgrade Guide</a></li><li><a href="/goyave/guide/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/goyave/guide/architecture-concepts.html" class="active sidebar-link">Architecture Concepts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/goyave/guide/architecture-concepts.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/goyave/guide/architecture-concepts.html#terminology" class="sidebar-link">Terminology</a></li><li class="sidebar-sub-header"><a href="/goyave/guide/architecture-concepts.html#lifecycle" class="sidebar-link">Lifecycle</a></li><li class="sidebar-sub-header"><a href="/goyave/guide/architecture-concepts.html#directory-structure" class="sidebar-link">Directory structure</a></li><li class="sidebar-sub-header"><a href="/goyave/guide/architecture-concepts.html#database" class="sidebar-link">Database</a></li></ul></li><li><a href="/goyave/guide/deployment.html" class="sidebar-link">Deployment</a></li><li><a href="/goyave/guide/contribution-guide.html" class="sidebar-link">Contributing to Goyave</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Basics</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="architecture-concepts"><a href="#architecture-concepts" class="header-anchor">#</a> Architecture Concepts</h1> <p></p><div class="table-of-contents"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#terminology">Terminology</a></li><li><a href="#lifecycle">Lifecycle</a><ul><li><a href="#server">Server</a></li><li><a href="#requests">Requests</a></li></ul></li><li><a href="#directory-structure">Directory structure</a><ul><li><a href="#database-directory">Database directory</a></li><li><a href="#http-directory">HTTP directory</a></li><li><a href="#resources-directory">Resources directory</a></li><li><a href="#custom-directories">Custom directories</a></li></ul></li><li><a href="#database">Database</a></li></ul></div><p></p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Understanding your development tools and knowing what happens in the background is crucial. Mastering your tools and environment incredibily decreases the risk of errors, the ease of debugging and helps making your code work in harmony with the framework. The goal of this section is to give you an overview of the general functioning and design of the framework, to make you more comfortable and confident using it.</p> <h2 id="terminology"><a href="#terminology" class="header-anchor">#</a> Terminology</h2> <p>This section will briefly explain the technical words used in the following sections.</p> <p><strong>Lifecycle</strong>: An execution from start to finish, with intermediary steps.</p> <p><strong>Framework core</strong>: Features and behaviors executed internally and that are invisible to the application developer.</p> <p><strong>Handler</strong>: A function receiving incoming requests and a response writer. Multiple handlers can be executed for the same request.</p> <p><strong>Router</strong>: The root-level handler responsible for the execution of the correct controller handler.</p> <p><strong>Route</strong>: A URI definition linked to a controller handler. If a request matches the definition, the router will execute the associated controller handler.</p> <p><strong>Controller</strong>: A source file implementing the business logic linked to a specific resource and associated routes.</p> <p><strong>Middleware</strong>: A handler executed before controller handlers. Middleware can intercept the request, modify its data, and send a response before the controller handler is reached.</p> <p><strong>Application</strong>: A program using the Goyave framework as a library.</p> <p><strong>Model</strong>: A structure reflecting a database table structure. An instance of a model is a single database record.</p> <h2 id="lifecycle"><a href="#lifecycle" class="header-anchor">#</a> Lifecycle</h2> <h3 id="server"><a href="#server" class="header-anchor">#</a> Server</h3> <p>The very first step of the server lifecycle is the <strong>server setup</strong>, taking place when you call <code>goyave.Start(route.Register)</code> in your application's main function.</p> <p>Goyave starts by loading the <a href="./configuration">configuration</a> file from the core of the framework. The application's configuration file is then loaded, overriding the default values.</p> <p>The second step of the initialization takes a very similar approach to load the <a href="./advanced/localization">language</a> files. The <code>en-US</code> language is available by default inside the framework and is used as the default language. When it's loaded, the framework will look for custom language files inside the working directory and will override the <code>en-US</code> language entries if needed.</p> <p>Then, if enabled, the automatic migrations are run, thus creating the <a href="./basics/database">database</a> connection pool. If the automatic migrations are not enabled, no connection to the database will be established until the application requires one.</p> <p>That is only now that <a href="./basics/routing">routes</a> are registered using the route registrer provided to the <code>Start()</code> function. That means that at this registrer has already access to all the configuration and language features, which can be handy if you want to generate different routes based on the languages your application supports.</p> <p>Finally, the framework starts listening for incoming HTTP requests and serves them. The server also listens for interruption and termination signals so it can finish serving ongoing requests before shutting down gracefully. In the next section, we will get into more details about the lifecycle of each request.</p> <h3 id="requests"><a href="#requests" class="header-anchor">#</a> Requests</h3> <p>When an incoming request is received, it's first passed through the <a href="https://github.com/gorilla/mux" target="_blank" rel="noopener noreferrer">Gorilla Mux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> router so your server knows which handler to execute when a user requests a specific URI. Then, the framework's internal handler creates a <code>goyave.Request</code> object and a <code>goyave.Response</code> object from the raw request. These two objects are fundamental features of the framework as you are going to use them to retrieve the requests' data and write your responses.</p> <p>Before executing the handler, the middleware are executed. The framework features a few core middleware, which are executed <strong>first</strong> and for all routes and all requests.</p> <h4 id="_1-recovery"><a href="#_1-recovery" class="header-anchor">#</a> 1. Recovery</h4> <p>The <strong>recovery</strong> middleware is executed. This middleware ensures that any unrecovered panic is handled. Instead of never returning a response in case of a panic, the server will then return an HTTP 500 Error. If debugging is enabled if the configuration, the response will contain the error message and the stacktrace will be printed in the console. It's important to keep this behavior in mind when handling errors in your handlers.</p> <h4 id="_2-parsing"><a href="#_2-parsing" class="header-anchor">#</a> 2. Parsing</h4> <p>The request is <strong>parsed</strong> by a second middleware. This middleware will automatically detect the request's body format based on the headers and attempt to parse it. If the request can't be parsed, the request's data is simply set to <code>nil</code>. This middleware supports JSON requests.</p> <h4 id="_3-language"><a href="#_3-language" class="header-anchor">#</a> 3. Language</h4> <p>The <code>Accept-Language</code> header is checked. If it's there, its value is parsed and the request's language attribute is set accordingly so localization is easy in the following handlers. If the header is missing, invalid, or asks for an unsupported language, the framework falls back to the default language defined in the configuration. Learn more <a href="./advanced/localization">here</a>.</p> <h4 id="_4-application-middlewares"><a href="#_4-application-middlewares" class="header-anchor">#</a> 4. Application middlewares</h4> <p>Application middlewares are executed. These middlewares are implemented and defined by the application developer. Note that some application middleware are already available in the framework. Learn more in the <a href="./basics/middleware">middlewares</a> section. At this stage of the lifecycle, the request is not validated yet, so application middleware can be used for authentication or automatic string trimming for example. Bear in mind that manipulating unvalidated data can be dangerous, especially in form-data where the data types are not converted by the validator yet.</p> <h4 id="_5-validation"><a href="#_5-validation" class="header-anchor">#</a> 5. Validation</h4> <p>The data is validated last. The validation middleware immediately passes if no rules have been defined for the current route, else, it check if the data parsing was successful. An automatic response is sent if that is not the case. The data is passed through the validator, which converts the data types and validates it. The request is stopped if the validation is not successful, and the validation errors are sent as a response. Be careful when working with unvalidated requests (which you should never do!) because if the request's parsing fails, <code>request.Data</code> will be <code>nil</code>.</p> <h4 id="_6-controller-handler"><a href="#_6-controller-handler" class="header-anchor">#</a> 6. Controller handler</h4> <p>Finally, if the request has not been stopped by a middleware, the controller handler is executed.
If the controller handler didn't write anything as a response, an empty response with the HTTP status code 204 &quot;No Content&quot; is automatically sent, so you don't have to do it yourself.</p> <h2 id="directory-structure"><a href="#directory-structure" class="header-anchor">#</a> Directory structure</h2> <p>Goyave follows the principle of &quot;<strong>Convention is better than configuration</strong>&quot;. That means that the framework will attempt to automatically get the resources it needs from predefined directories.
The typical and recommended directory structure for Goyave applications is as follows:</p> <pre class="vue-container"><code><p>.
├── database
│   └── models
│       └── <em>...</em>
├── http
│   ├── controllers
│   │   └── <em>...</em>
│   ├── middleware
│   │   └── <em>...</em>
│   ├── requests
│   │   ├── placeholders.go (<em>optional</em>)
│   │   ├── validation.go (<em>optional</em>)
│   │   └── <em>...</em>
│   └── routes
│       └── routes.go
│
├── resources
│   ├── lang
│   │   └── en-US (<em>language name</em>)
│   │       ├── fields.json (<em>optional</em>)
│   │       ├── locale.json (<em>optional</em>)
│   │       └── rules.json (<em>optional</em>)
│   └── img (<em>optional</em>)
│       └── <em>...</em>
│ 
├── .gitignore
├── config.json
├── go.mod
└── kernel.go</p>
</code></pre><h3 id="database-directory"><a href="#database-directory" class="header-anchor">#</a> Database directory</h3> <p>The <code>database</code> directory stores the models. Each model should have its own file in the <code>models</code> package. This directory can also contain database-related code such as repositories, if you want to use this pattern.</p> <h3 id="http-directory"><a href="#http-directory" class="header-anchor">#</a> HTTP directory</h3> <p>The <code>http</code> directory contains all the HTTP-related code. This is where most of your code will be written.</p> <h4 id="http-controllers"><a href="#http-controllers" class="header-anchor">#</a> HTTP controllers</h4> <p>The <code>http/controllers</code> directory contains the controller packages. Each feature should have its own package. For example, if you have a controller handling user registration, user profiles, etc, you should create a <code>http/controllers/user</code> package. Creating a package for each feature has the advantage of cleaning up route definitions a lot and helps keeping a clean structure for your project. Learn more <a href="./basics/controllers">here</a>.</p> <h4 id="http-middleware"><a href="#http-middleware" class="header-anchor">#</a> HTTP middleware</h4> <p>The <code>http/middleware</code> directory contains the application middleware. Each middleware should have its own file. Learn more <a href="./basics/middleware">here</a>.</p> <h4 id="http-requests"><a href="#http-requests" class="header-anchor">#</a> HTTP requests</h4> <p>The <code>http/requests</code> directory contains the requests validation rules sets. You should have one package per feature, regrouping all requests handled by the same controller.</p> <p>This directory can also contain a <code>placeholders.go</code> file, which will define validation rule messages placeholders. Learn more <a href="./basics/validation#placeholders">here</a>.</p> <p>This directory can also contain a <code>validation.go</code> file, which will define custom validation rules. Learn more <a href="./basics/validation#custom-rules">here</a>.</p> <h4 id="http-routes"><a href="#http-routes" class="header-anchor">#</a> HTTP Routes</h4> <p>The <code>http/routes</code> directory contains the routes définitions. By default, all routes are registered in the <code>routes.go</code> file, but for bigger projects, split the route definitions into multiple files.</p> <h3 id="resources-directory"><a href="#resources-directory" class="header-anchor">#</a> Resources directory</h3> <p>The <code>resources</code> directory is meant to store static resources such as images, HTML documents and language files. This directory shouldn't be used as a storage for dynamic content such as user profile pictures.</p> <h4 id="language-resources-directory"><a href="#language-resources-directory" class="header-anchor">#</a> Language resources directory</h4> <p>The <code>resources/lang</code> directory contains your application's supported languages and translations. Each language has its own directory and should be named with an <a href="https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes" target="_blank" rel="noopener noreferrer">ISO 639-1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> language code. You can also append a variant to your languages: <code>en-US</code>, <code>en-UK</code>, <code>fr-FR</code>, <code>fr-CA</code>, ... <strong>Case is important.</strong></p> <p>Each language directory contains three files. Each file is <strong>optional</strong>.</p> <ul><li><code>fields.json</code>: field names translations and field-specific rule messages.</li> <li><code>locale.json</code>: all other language lines.</li> <li><code>rules.json</code>: validation rules messages.</li></ul> <p>Learn more about localization <a href="./advanced/localization">here</a>.</p> <h3 id="custom-directories"><a href="#custom-directories" class="header-anchor">#</a> Custom directories</h3> <p>You may add custom directories for your custom utilities, as they don't belong to any of the above directories. For example, if you develop a service manipulating images, the image processing code shouldn't be written in controller handlers, they are not part of the business logic. You would then create a <code>processing</code> directory, containing your code in <code>images.go</code> for example.</p> <h2 id="database"><a href="#database" class="header-anchor">#</a> Database</h2> <p>Database connections are managed by the framework and are long-lived. When the server shuts down, the database connections are closed automatically. So you don't have to worry about creating, closing or refreshing database connections in your application.</p> <p>If automatic migrations are enabled, all registered models at the time of startup will be auto-migrated. They must be registered before the server starts, ideally from an <code>init()</code> function next to each model definition.</p> <p>Learn more in the <a href="./basics/database">database</a> section.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/System-Glitch/goyave/edit/master/docs_src/src/guide/architecture-concepts.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/goyave/guide/configuration.html" class="prev">Configuration</a></span> <span class="next"><a href="/goyave/guide/deployment.html">Deployment</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/goyave/assets/js/app.9469ee64.js" defer></script><script src="/goyave/assets/js/2.f9d2a18e.js" defer></script><script src="/goyave/assets/js/14.aee9063a.js" defer></script>
  </body>
</html>
