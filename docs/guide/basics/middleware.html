<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Middleware | Goyave</title>
    <meta name="description" content="An Elegant Golang Web Framework">
    <link rel="icon" type="image/png" sizes="16x16" href="/goyave/goyave_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/goyave/goyave_32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="/goyave/goyave_64.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/goyave/goyave_128.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/goyave/goyave_256.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/goyave/goyave_512.png">
    
    <link rel="preload" href="/goyave/assets/css/0.styles.3299ef2d.css" as="style"><link rel="preload" href="/goyave/assets/js/app.17e60c60.js" as="script"><link rel="preload" href="/goyave/assets/js/2.906a9991.js" as="script"><link rel="preload" href="/goyave/assets/js/17.b5dc11c2.js" as="script"><link rel="preload" href="/goyave/assets/js/3.e099aa3a.js" as="script"><link rel="prefetch" href="/goyave/assets/js/10.30cc424c.js"><link rel="prefetch" href="/goyave/assets/js/11.c4154331.js"><link rel="prefetch" href="/goyave/assets/js/12.4af04314.js"><link rel="prefetch" href="/goyave/assets/js/13.ec39cc61.js"><link rel="prefetch" href="/goyave/assets/js/14.4dec21f5.js"><link rel="prefetch" href="/goyave/assets/js/15.3c10886f.js"><link rel="prefetch" href="/goyave/assets/js/16.0fe12c44.js"><link rel="prefetch" href="/goyave/assets/js/18.67cacf15.js"><link rel="prefetch" href="/goyave/assets/js/19.e346a1da.js"><link rel="prefetch" href="/goyave/assets/js/20.1ab2c23a.js"><link rel="prefetch" href="/goyave/assets/js/21.9c611e78.js"><link rel="prefetch" href="/goyave/assets/js/22.062593e0.js"><link rel="prefetch" href="/goyave/assets/js/23.9dc43116.js"><link rel="prefetch" href="/goyave/assets/js/24.15d9a53f.js"><link rel="prefetch" href="/goyave/assets/js/25.063b51bd.js"><link rel="prefetch" href="/goyave/assets/js/26.40c68345.js"><link rel="prefetch" href="/goyave/assets/js/27.4bbe03f5.js"><link rel="prefetch" href="/goyave/assets/js/28.57bb5ec4.js"><link rel="prefetch" href="/goyave/assets/js/4.c70817cb.js"><link rel="prefetch" href="/goyave/assets/js/5.adc8bba2.js"><link rel="prefetch" href="/goyave/assets/js/6.5038a67a.js"><link rel="prefetch" href="/goyave/assets/js/7.2e2ed707.js"><link rel="prefetch" href="/goyave/assets/js/8.d27f9913.js"><link rel="prefetch" href="/goyave/assets/js/9.70cd729a.js">
    <link rel="stylesheet" href="/goyave/assets/css/0.styles.3299ef2d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/goyave/" class="home-link router-link-active"><img src="/goyave/goyave_64.png" alt="Goyave" class="logo"> <span class="site-name can-hide">Goyave</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/goyave/guide/" class="nav-link router-link-active">Guide</a></div> <a href="https://github.com/System-Glitch/goyave" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/goyave/guide/" class="nav-link router-link-active">Guide</a></div> <a href="https://github.com/System-Glitch/goyave" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>The Basics</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/goyave/guide/basics/routing.html" class="sidebar-link">Routing</a></li><li><a href="/goyave/guide/basics/middleware.html" class="active sidebar-link">Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/goyave/guide/basics/middleware.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/goyave/guide/basics/middleware.html#writing-middleware" class="sidebar-link">Writing middleware</a></li><li class="sidebar-sub-header"><a href="/goyave/guide/basics/middleware.html#included-middleware" class="sidebar-link">Included middleware</a></li></ul></li><li><a href="/goyave/guide/basics/requests.html" class="sidebar-link">Requests</a></li><li><a href="/goyave/guide/basics/controllers.html" class="sidebar-link">Controllers</a></li><li><a href="/goyave/guide/basics/responses.html" class="sidebar-link">Responses</a></li><li><a href="/goyave/guide/basics/database.html" class="sidebar-link">Database</a></li><li><a href="/goyave/guide/basics/validation.html" class="sidebar-link">Validation</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="middleware"><a href="#middleware" class="header-anchor">#</a> Middleware</h1> <p></p><div class="table-of-contents"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#writing-middleware">Writing middleware</a></li><li><a href="#included-middleware">Included middleware</a><ul><li><a href="#disallownonvalidatedfields">DisallowNonValidatedFields</a></li><li><a href="#trim">Trim</a></li></ul></li></ul></div><p></p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Middleware are handlers executed before the controller handler. They are a convenient way to filter, intercept or alter HTTP requests entering your application. For example, middleware can be used to authenticate users. If the user is not authenticated, a message is sent to the user even before the controller handler is reached. However, if the user is authenticated, the middleware will pass to the next handler. Middleware can also be used to sanitize user inputs, by trimming strings for example, to log all requests into a log file, to automatically add headers to all your responses, etc.</p> <p>Writing middleware is as easy as writing standard handlers. In fact, middleware are handlers, but they have an additional responsability: when they are done, the may or may not pass to the next handler, which is either another middleware or a controller handler.</p> <h2 id="writing-middleware"><a href="#writing-middleware" class="header-anchor">#</a> Writing middleware</h2> <p>Each middleware is written in its own file inside the <code>http/middleware</code> directory. A <code>Middleware</code> is a function returning a <code>Handler</code>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>goyave.Middleware</code> is an alias for <code>func(goyave.Handler) goyave.Handler</code></p></div> <p><strong>Example:</strong></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">MyCustomMiddleware</span><span class="token punctuation">(</span>next goyave<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> goyave<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>response <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> request <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Do something</span>
        <span class="token function">next</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> request<span class="token punctuation">)</span> <span class="token comment">// Pass to the next handler</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When implementing middleware, keep in mind that the request <strong>has not been validated yet</strong>! Manipulating unvalidated data can be dangerous, especially in form-data where the data types are not converted by the validator yet. In middleware, you should always check if the request has been parsed correctly before trying to access its data:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">if</span> request<span class="token punctuation">.</span>Data <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">// Parsing OK</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you want your middleware to stop the request and respond immediately before reaching the controller handler, simply don't call the <code>next</code> handler. In the following example, consider that you developed a custom authentication system:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">CustomAuthentication</span><span class="token punctuation">(</span>next goyave<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> goyave<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>response <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> request <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>auth<span class="token punctuation">.</span><span class="token function">Check</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            response<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusUnauthorized<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        <span class="token function">next</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When a middleware stops a request, following middlewares are <strong>not</strong> executed either.</p></div> <h2 id="included-middleware"><a href="#included-middleware" class="header-anchor">#</a> Included middleware</h2> <p>Included middleware are located in the <code>middleware</code> package.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;github.com/System-Glitch/goyave/middleware&quot;</span>
</code></pre></div><h3 id="disallownonvalidatedfields"><a href="#disallownonvalidatedfields" class="header-anchor">#</a> DisallowNonValidatedFields</h3> <p>DisallowNonValidatedFields validates that all fields in the request are validated by the RuleSet. The middleware stops the request and sends &quot;422 Unprocessable Entity&quot; and an error message if the user has sent non-validated field(s). Fields ending with <code>_confirmation</code> are ignored.</p> <p>If the body parsing failed, this middleware immediately passes to the next handler. <strong>This middleware shall only be used with requests having a rule set defined.</strong></p> <p>The returned error message can be customized using the entry <code>disallow-non-validated-fields</code> in the <code>locale.json</code> language file.</p> <div class="language-go extra-class"><pre class="language-go"><code>router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>middleware<span class="token punctuation">.</span>DisallowNonValidatedFields<span class="token punctuation">)</span>
</code></pre></div><h3 id="trim"><a href="#trim" class="header-anchor">#</a> Trim</h3> <p><span class="badge tip" style="vertical-align:top;" data-v-c13ee5b0>Since v2.0.0</span></p> <p>Trim removes all leading and trailing white space from string fields.</p> <p>For example, <code>&quot; \t trimmed\n \t&quot;</code> will be transformed to <code>&quot;trimmed&quot;</code>.</p> <div class="language-go extra-class"><pre class="language-go"><code>router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>middleware<span class="token punctuation">.</span>Trim<span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/System-Glitch/goyave/edit/master/docs_src/src/guide/basics/middleware.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/goyave/guide/basics/routing.html" class="prev">Routing</a></span> <span class="next"><a href="/goyave/guide/basics/requests.html">Requests</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/goyave/assets/js/app.17e60c60.js" defer></script><script src="/goyave/assets/js/2.906a9991.js" defer></script><script src="/goyave/assets/js/17.b5dc11c2.js" defer></script><script src="/goyave/assets/js/3.e099aa3a.js" defer></script>
  </body>
</html>
